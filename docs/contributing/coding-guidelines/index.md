# Coding guidelines

!!! warning

    Under Construction

## Common guidelines

Every file should have a license header; see the _License_ section in [CONTRIBUTING.md](https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/blob/master/CONTRIBUTING.md).

## Version

Only C++14 and below is allowed for functional code.
Python 3.7+ and Bash are allowed for tooling.
CMake is the preferred build system, it should integrate with Colcon.
Deviations need to be approved by the maintainers.

The requirements for C++14 and Python 3.7+ align with compiler and tooling support found in ROS Foxy.
This may change in the future as new OS or ROS environments are targeted; see @ref target-environments for details.

Sometimes custom versions are allowed in Autoware.

### Committing {#contributors-guidelines-committing}

Developers should commit and push regularly to GitLab to avoid data loss. Commit messages should follow common standards as laid out in this [post](https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html). In summary,

1. Write your commit message in the imperative
1. In the mandatory first line, summarize _what_ the functional change is, not _why_ it is introduced
1. Optionally add more details separated by a blank line

As a general recommendation, add a reference to the issue in the commit message so it is easier for others in the future to get more context about the changes in the commit. If the commit doesn't refer to a particular issue but only touches a particular package or aspect, add a reference to that.

Example summary line referring to issue #716:

```{text}
[#716] Expand contributor guidelines
```

Example summary line without an issue:

```{text}
[CI] Disable flaky tests in foo and bar packages
```

There is assistance via `git` hooks to help with commit messages. Navigate to `.git/hooks` in the checkout of Autoware.Auto, then:

```{bash}
ln -s ../../.git-hooks/prepare-commit-msg  # prepend issue number
ln -s ../../.git-hooks/commit-msg          # check formatting of commit message
```

#### Utilizing git pre-commit

To lint the code automatically before each commit, activate the `pre-commit` [hook](https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto/-/blob/master/.git-hooks/pre-commit). From the repository base directory, do:

```{bash}
cd .git/hooks
ln -s ../../.git-hooks/pre-commit
```

### Code Coverage {#contributors-guidelines-coverage}

For [code coverage](https://en.wikipedia.org/wiki/Code_coverage), we use the popular [GNU tool `lcov`](http://ltp.sourceforge.net/coverage/lcov.php) for generating statistics about line coverage. For every merge request, we run our test suite and report the percentage of lines covered. We aim for a 100% line coverage and continuously improve our test suite to achieve that number. In particular, we do not accept changes that reduce the coverage value. If a merge request has a lower line coverage than `master`, we will request the contributor to add more tests.

The coverage report for the latest successful CI run on the `master` branch is available [here](https://autowarefoundation.gitlab.io/autoware.auto/AutowareAuto/coverage/index.html).

Check @ref unit-testing-coverage for details to create that report manually or @ref testing-overview for more information.

## Guidelines for ROS Development

In general, Autoware.Auto follows the [ROS 2 Developer Guide](https://index.ros.org/doc/ros2/Contributing/Developer-Guide/) for contributions, except where noted. Some special items of note that are not described in the ROS 2 Developer Guide are listed below.

### Creating a New Package

Basic instructions for creating a new ROS 2 package can be found [in this tutorial](https://index.ros.org//doc/ros2/Tutorials/Colcon-Tutorial/#create-your-own-package). In Autoware.Auto, much of the boilerplate code can be automatically generated by utilizing the `autoware_auto_create_pkg` tool.

For more information on using the tool, see \ref autoware_auto_create_pkg-package-design.
